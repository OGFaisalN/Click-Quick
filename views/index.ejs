<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no" />
	<meta name="theme-color" content="#000000" />
	<title>Welcome to my app</title>
	<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
	<link rel="apple-touch-icon" sizes="76x76" href="../apple-icon.png" />
	<link rel="android-chrome-192x192" href="../android-icon-192x192.png" />
	<link rel="android-chrome-512x512" href="../android-icon-512x512.png" />
	<link rel="stylesheet" href="../styles.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Urbanist:300,400,500,700&display=swap" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>

<body>
	<header>
		<div class="left">
			<a class="back" onClick="history.back()">
				<span class="material-symbols-outlined">
					arrow_back
				</span>
			</a>
			<a class="logo" href="/">
				<img src="logo.jpeg" />
				<h1>Click Quick</h1>
			</a>
			<a class="tokens" href="/tokens">
				<img src="token.jpeg" />
				<div>
					<h3>Tokens</h3>
					<h4>Claim free tokens</h4>
				</div>
			</a>
		</div>
		<div class="right">
			<div class="search">
				<input type="text" placeholder="Search" />
				<i class="fas fa-search"></i>
			</div>
			<div class="profile">
				<img src="profile.jpeg" />
				<div>
					<h3>John Doe</h3>
					<h4>View profile</h4>
				</div>
			</div>
		</div>
	</header>
	<% if (error != null) { %>
	<div id="error"><%= error %></div>
	<% } %>
	<h1>Welcome to my app</h1>
	<button color="primary" variant="contained" onClick="handleCreateRoom()">
		Create a private room
	</button>
	<br />
	<button color="secondary" variant="contained" onClick="handleJoinPublicRoom()">
		Join a public room
	</button>
	<br />
	<input type="text" id="roomCode" value="" onChange="handleInputChange()" />
	<br />
	<button variant="contained" onClick="handleJoinPrivateRoom()">
		Join a private room
	</button>
	<h2>Game room: <h2 class="gameRoom"><%= roomId %></h2>
	</h2>
	<h3>Players:</h3>
	<ul id="playersList">
		<% players.forEach(player => { %>
		<li><%= player %></li>
		<% }); %>
	</ul>
	<h2>Room type: <h2 class="roomType"><%= roomType %></h2>
	</h2>
	<h2>Your ID: <%= socket.id %></h2>
	<h2>Rooms:</h2>
	<ul id="roomsList">
		<% for (const [key, value] of Object.entries(rooms)) { %>
		<li><%= key %></li>
		<% }; %>
	</ul>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		window.onerror = function(e) {
			document.getElementById('prompt').innerHTML = e.toString();
		};

		const socket = io();
		var roomId = '<%= roomId %>';
		var roomType = '<%= roomType %>';
		var roomCode = '';
		var players = <%- JSON.stringify(players) %>;

		socket.on('connect', () => {
			console.log('Connected to server');
			socket.emit('join room', roomId);
		});

		socket.on('new room', (type, id) => {
			console.log(`New ${type} room created with ID ${id}`);
			roomType = type;
			roomId = id;
			updateRoom();
		});

		socket.on('update players', (updatedPlayers) => {
			console.log('Player list updated', updatedPlayers);
			players = updatedPlayers;
			renderPlayers();
		});

		function handleCreateRoom() {
			socket.emit('create room', 'friends');
		};

		function handleJoinPublicRoom() {
			socket.emit('join room', 'public');
		};

		function handleJoinPrivateRoom() {
			location.href = `/join/${roomCode}`;
		};

		function handleInputChange() {
			roomCode = document.getElementById('roomCode').value;
		};

		function renderPlayers() {
			var playersList = document.getElementById('playersList');
			playersList.innerHTML = '';
			players.forEach((player) => {
				var li = document.createElement('li');
				li.innerText = player;
				playersList.appendChild(li);
			});
		};

		function updateRoom() {
			document.querySelectorAll('.gameRoom').forEach(gameRoom => {
				gameRoom.innerText = roomId;
			});
		};
	</script>
</body>

</html>